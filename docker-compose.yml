version: "2"
services:
  web:
    container_name: laramove_web
    build: .
    ports:
    - "8080:8080"
    depends_on:
    - mongo
    environment:
      - MONGO_URL=mongodb://user:password@mongo:27017/lmdb
      - NODE_ENV=production
  test:
    container_name: laramove_test
    build: ./tests
    ports:
    - "8080:8080"
    depends_on:
    - laramove_web  
    environment:
      - MONGO_URL=mongodb://user:password@mongo:27017/lmdb_test
      - NODE_ENV=test
  mongo:
    image: aashreys/mongo-auth:latest
    container_name: laramove_mongo
    environment:
      - AUTH=yes
      - MONGODB_ADMIN_USER=root
      - MONGODB_ADMIN_PASS=password
      - MONGODB_APPLICATION_DATABASE=lmdb
      - MONGODB_APPLICATION_USER=user
      - MONGODB_APPLICATION_PASS=password
      - MONGODB_APPLICATION_DATABASE=lmdb_test
      - MONGODB_APPLICATION_USER=user
      - MONGODB_APPLICATION_PASS=password
    ports:
      - "27017:27017"
 